# ルーム状態フロー

## ルームステータスの概要

CoJamのルームには以下の4つのステータスがあります：

1. **scheduled（予定）**：ルーム作成直後の初期状態です。このステータスではルームの詳細ページでルームの情報を確認でき、演者として参加申請することができます。

2. **ready（準備完了）**：予定時刻を過ぎるとこのステータスに自動的に変更されます。視聴者として参加でき、演者としての参加申請もできます。ホストはこの状態でセッションを開始することができます。

3. **live（ライブ中）**：ホストがセッションを開始するとこのステータスになります。実際のWebRTC接続が確立され、演者と視聴者がリアルタイムで通信できます。

4. **ended（終了）**：ホストがルームを終了するとこのステータスになります。このステータスのルームには参加できません。

## 状態遷移のフロー

```
[scheduled] ---(時間経過)---> [ready] ---(ホストがセッション開始)---> [live] ---(ホストがルーム終了)---> [ended]
```

## 各ステータスでの機能

### scheduled（予定）
- ルーム情報の閲覧
- 演者として参加申請
- ホストによる申請承認/拒否

### ready（準備完了）
- ルーム情報の閲覧
- 演者として参加申請
- ホストによる申請承認/拒否
- 視聴者として参加
- ホストによるセッション開始

### live（ライブ中）
- ルーム情報の閲覧
- 演者としてセッションに参加（承認済みの場合）
- 視聴者としてセッションに参加
- ホストによるルーム終了

### ended（終了）
- ルーム情報の閲覧のみ
- アーカイブの視聴（アーカイブが有効な場合）

## ユーザー操作と状態変化

1. **ルーム作成**：
   - ユーザーがルームを作成
   - ステータスは自動的に「scheduled」になる
   - 開始予定時刻を設定

2. **準備完了への自動移行**：
   - スケジューラーが1分ごとに予定時刻を過ぎたルームをチェック
   - 該当するルームのステータスを「ready」に変更

3. **セッション開始**：
   - ホストがルーム詳細ページで「セッションを開始する」ボタンをクリック
   - バックエンドでステータスを「live」に変更
   - 開始時刻（startedAt）を記録
   - WebRTCセッションページへ遷移

4. **ルーム終了**：
   - ホストが「ルームを終了する」ボタンをクリック
   - バックエンドでステータスを「ended」に変更
   - 終了時刻（endedAt）を記録
   - 全参加者の接続を終了 