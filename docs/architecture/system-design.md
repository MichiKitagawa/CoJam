# システム設計図

## アーキテクチャ概要

```
[クライアント]         [サーバー]              [インフラ]
+-------------+      +----------------+     +---------------+
| React/Next.js| <--> | Node.js API    | <-> | AWS EC2/ECS   |
| WebRTC      |      | WebSocket      |     | RDS/DynamoDB  |
+-------------+      +----------------+     | S3/CloudFront |
                     | SFU Media Server|     +---------------+
                     +----------------+
```

## コンポーネント構成

### フロントエンド（Next.js）
- **認証モジュール**：ユーザー認証・セッション管理
- **ルーム管理**：作成・参加・検索機能
- **メディア処理**：WebRTC接続・音声処理
- **決済連携**：Stripe連携・チケット処理
- **UI/UXコンポーネント**：レスポンシブデザイン

### バックエンド（Node.js）
- **API層**：RESTful APIエンドポイント
- **WebSocketサーバー**：リアルタイム通信
- **SFUサーバー**：WebRTC接続管理
- **メディアミキシング**：音声合成・配信処理
- **認証・認可**：JWT・RBAC実装
- **データアクセス層**：DB操作抽象化

### データベース
- **ユーザー**：プロフィール・認証情報
- **ルーム**：セッション情報・設定
- **トランザクション**：決済・チケット情報
- **コンテンツ**：アーカイブメタデータ

## データフロー

1. **リアルタイムセッション**
   ```
   演者A/B/C → WebRTC → SFUサーバー → WebRTC → 演者A/B/C
                           ↓
                       ミキシング
                           ↓
                    CDN → リスナー
   ```

2. **決済フロー**
   ```
   リスナー → Stripe API → バックエンド → DB保存 → 演者へ配分
   ```

3. **アーカイブフロー**
   ```
   ライブセッション → サーバー録画 → S3保存 → CDN配信 → リスナー視聴
   ``` 