# テスト戦略

## テストレベル

### 1. ユニットテスト

- **対象**: 個別コンポーネント、関数、クラス
- **ツール**: Jest, React Testing Library
- **実行タイミング**: コミット前、CI実行時
- **カバレッジ目標**: 80%以上

### 2. 統合テスト

- **対象**: APIエンドポイント、データフロー、サービス間連携
- **ツール**: Supertest, Jest
- **実行タイミング**: CI実行時
- **カバレッジ目標**: 主要フロー100%

### 3. E2Eテスト

- **対象**: ユーザーフロー全体（登録→ルーム作成→参加→決済など）
- **ツール**: Cypress, Playwright
- **実行タイミング**: デプロイ前、重要リリース時
- **カバレッジ目標**: 重要ユーザーフロー100%

### 4. パフォーマンステスト

- **対象**: WebRTC通信、同時接続、メディア処理
- **ツール**: k6, カスタムスクリプト
- **実行タイミング**: 重要な機能変更時、リリース前
- **目標**: レイテンシ<500ms（P95）、同時接続100ユーザー対応

## テスト自動化

### CI/CDパイプライン

```
コミット → ユニットテスト → ビルド → 統合テスト → デプロイ（テスト環境） → E2Eテスト → デプロイ（本番）
```

### テスト環境

1. **ローカル開発環境**
   - モックサービス利用
   - インメモリDB
   
2. **テスト環境（dev）**
   - クラウド上の分離環境
   - テスト用DB（毎回リセット）
   - Stripeテストモード

3. **ステージング環境**
   - 本番と同等構成
   - 実際のインフラ使用
   - テストデータでの結合テスト

## テストデータ管理

- シードスクリプトによる初期データ投入
- テスト用アカウント管理（役割別）
- サンドボックス決済環境

## WebRTC/メディア特化テスト

1. **ネットワーク耐性テスト**
   - パケットロス・遅延注入
   - ネットワーク帯域制限シミュレーション

2. **音声品質テスト**
   - 音声データの品質測定
   - エコー・ノイズキャンセル検証

3. **同時接続テスト**
   - 演者多人数接続安定性
   - 視聴者大規模接続シミュレーション

## セキュリティテスト

1. **脆弱性スキャン**
   - 静的解析（SonarQube, ESLint）
   - 依存パッケージ脆弱性チェック（npm audit）

2. **ペネトレーションテスト**
   - 認証・認可検証
   - API入力検証
   - XSS/CSRF検証

## バグトラッキング・修正フロー

1. テスト中の問題発見 → Issueログ作成
2. 優先度評価・アサイン
3. 修正・単体テスト作成
4. レビュー・マージ
5. リグレッションテスト実行 